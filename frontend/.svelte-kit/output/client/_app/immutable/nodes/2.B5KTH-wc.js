import"../chunks/DsnmJJEf.js";import{i as zt}from"../chunks/D-A7yCOM.js";import{o as Dt,e as k,s as h}from"../chunks/BDJC6Cp_.js";import{p as Pt,f as v,a as ct,t as g,c as n,g as e,b as l,d as Rt,s,e as d,m as x,i as tt,r as a,h as $t}from"../chunks/BDVzeZar.js";import{i as I}from"../chunks/DE00MdZp.js";import{e as U,b as et,i as Y}from"../chunks/YH6WcyyF.js";import{r as qt,s as lt}from"../chunks/Cs6Urel8.js";import{b as At}from"../chunks/CTeKP5p8.js";import{g as dt}from"../chunks/ccQLpX6y.js";var Bt=v('<p class="text-red-500 text-center font-medium"> </p>'),Ft=v('<div class="absolute top-4 right-6 flex gap-3" style="position: absolute; top: 1rem; right: 1.5rem;"><button class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-md text-sm font-medium transition">Login como Cliente</button> <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1.5 rounded-md text-sm font-medium transition">Login como Adm</button></div>'),Mt=v("<option> </option>"),Ot=v("<button>Logout</button>"),Jt=v('<img class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"/>'),Ut=v('<div class="w-full h-full bg-gray-100 flex items-center justify-center text-gray-400 text-xs">No image</div>'),Yt=v('<div class="flex flex-col items-center text-center bg-white rounded-lg shadow-sm hover:shadow-md transition duration-200 p-1 cursor-pointer"><div class="relative w-full aspect-square max-w-[120px] rounded-md overflow-hidden"><!></div> <div class="mt-2 space-y-0.5 max-w-[100px] leading-tight"><h3 class="font-medium text-sm text-gray-800 truncate"> </h3> <p class="text-[11px] text-gray-500 line-clamp-2"> </p> <span class="inline-block text-[10px] bg-indigo-100 text-indigo-700 px-1 py-[1px] rounded-full"> </span></div></div>'),Gt=v('<div class="grid justify-center gap-x-2 gap-y-5" style="grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); max-width: 900px; margin: 0 auto;"></div>'),Ht=v('<p class="text-center text-gray-500 mt-8">No services found.</p>'),Kt=v("<option> </option>"),Qt=v("<option> </option>"),Wt=v(`<div style="
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    "><div style="
        background: black;
        color: white;
        border: 2px solid #444;
        border-radius: 1rem;
        padding: 1.5rem;
        width: 90%;
        max-width: 400px;
        text-align: center;
      "><h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;"> </h2> <p style="font-size: 0.875rem; margin-bottom: 1rem;"> </p> <div style="text-align: left; margin-bottom: 0.75rem;"><h3 style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem;">Selecione uma variacao:</h3> <select style="width: 100%; padding: 0.5rem; background: #111; color: white; border: 1px solid #555; border-radius: 0.375rem;"><option>-- Escolher variacao --</option><!></select></div> <div style="text-align: left; margin-bottom: 1rem;"><h3 style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem;">Selecione uma data e hora:</h3> <select style="width: 100%; padding: 0.5rem; background: #111; color: white; border: 1px solid #555; border-radius: 0.375rem;"><option>-- Escolher data/hora --</option><!></select></div> <div style="display: flex; justify-content: space-between; margin-top: 1rem;"><button style="background: #333; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem;">Cancelar</button> <button style="background: #4f46e5; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem;">Contratar</button></div></div></div>`),Xt=v('<div class="max-w-7xl mx-auto p-6 space-y-8"><header class="text-center space-y-2"><h1 class="text-3xl font-bold tracking-tight text-gray-900">Encontrar Servicos</h1> <p class="text-gray-500 text-sm">Procurar por nome ou descricao</p></header> <!> <!> <section class="bg-white/60 backdrop-blur-sm rounded-xl shadow-sm p-4 flex flex-wrap justify-center gap-3 sticky top-0 z-10"><input type="text" placeholder="Procurar por nome ou descricao..." class="border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg px-3 py-2 w-64 text-sm transition"/> <select class="border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg px-3 py-2 w-48 text-sm bg-white transition"><option>Todos os tipos</option><!></select> <!></section> <section class="mt-4"><!></section></div> <!>',1);function se(vt,pt){Pt(pt,!1);let B=x([]),G=x([]),F=x(""),D=x(""),P=x(""),u=x(null),L=x(""),N=x(""),R,H,K=x(!1);async function mt(){try{const t=await fetch("http://localhost:3000/api/service-types");if(!t.ok)throw new Error("Failed to load service types");d(G,await t.json())}catch(t){console.error("Error loading service types:",t),d(P,"Could not load service types.")}}async function Q(){try{const t=new URLSearchParams;e(F)&&t.append("q",e(F)),e(D)&&t.append("type",e(D));const r=await fetch(`/api/services/search?${t}`);if(!r.ok)throw new Error("Failed to load services");d(B,await r.json());for(let o of e(B)){const[i,c]=await Promise.all([fetch(`/api/services/${o.id}/variations`),fetch(`/api/services/${o.id}/available-dates`)]);o.variations=i.ok?await i.json():[],o.availableDates=c.ok?await c.json():[]}}catch(t){console.error("Error loading services:",t),d(P,"Could not load services.")}}function ut(){dt("/login")}function gt(){dt("/login-client")}function ft(t){if(console.log(H),!R||H!=="client"){alert("You voce deve estar cadastrado como cliente para contratar um servico.");return}d(u,t),d(L,""),d(N,"")}function rt(){d(u,null)}function _t(){localStorage.removeItem("token"),localStorage.removeItem("role"),location.reload()}async function ht(){if(!e(L)||!e(N)){alert("Please select both a variation and a date/time option.");return}try{R=localStorage.getItem("token");const t=await fetch("/api/contracts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify({service_id:e(u).id,variation:e(L),datetime:e(N)})});let r={};try{r=await t.json()}catch{r={}}if(!t.ok)throw new Error(r.error||"Failed to contract service");alert("Service contracted successfully!"),rt()}catch(t){console.error("Contract error:",t),alert(t.message||"Could not contract service.")}}function xt(t,r){if(!t||!r)return"Inválido";try{let o=String(t).split("T")[0],i=String(r).split(".")[0];const[c,p,z]=o.split("-").map(Number),[b,y]=i.split(":").map(Number);if(!c||!p||!z||isNaN(b)||isNaN(y))return"Inválido";const f=new Date(c,p-1,z,b,y),S=f.toLocaleDateString("pt-BR",{weekday:"short",year:"numeric",month:"long",day:"numeric"}),T=f.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});return`${S} às ${T}`}catch(o){return console.error("Erro ao formatar data:",o,t,r),`${t} ${r}`}}function bt(t,r){if(!t||!r)return"";const o=String(t).split("T")[0],i=String(r).split(".")[0].slice(0,5);return`${o}T${i}`}Dt(async()=>{R=localStorage.getItem("token"),H=localStorage.getItem("role")||"guest",d(K,!!R),await mt(),await Q()}),zt();var ot=Xt(),W=ct(ot),at=s(n(W),2);{var yt=t=>{var r=Bt(),o=n(r,!0);a(r),g(()=>h(o,e(P))),l(t,r)};I(at,t=>{e(P)&&t(yt)})}var it=s(at,2);{var wt=t=>{var r=Ft(),o=n(r),i=s(o,2);a(r),k("click",o,gt),k("click",i,ut),l(t,r)};I(it,t=>{e(K)||t(wt)})}var X=s(it,2),M=n(X);qt(M);var $=s(M,2);g(()=>{e(D),tt(()=>{e(G)})});var Z=n($);Z.value=Z.__value="";var kt=s(Z);U(kt,1,()=>e(G),Y,(t,r)=>{var o=Mt(),i=n(o,!0);a(o);var c={};g(()=>{h(i,e(r).type),c!==(c=e(r).type)&&(o.value=(o.__value=e(r).type)??"")}),l(t,o)}),a($);var St=s($,2);{var Tt=t=>{var r=Ot();k("click",r,_t),l(t,r)};I(St,t=>{e(K)&&t(Tt)})}a(X);var nt=s(X,2),jt=n(nt);{var Ct=t=>{var r=Gt();U(r,5,()=>e(B),Y,(o,i)=>{var c=Yt(),p=n(c),z=n(p);{var b=_=>{var C=Jt();g(()=>{lt(C,"src",e(i).picture),lt(C,"alt",e(i).name)}),l(_,C)},y=_=>{var C=Ut();l(_,C)};I(z,_=>{e(i).picture?_(b):_(y,!1)})}a(p);var f=s(p,2),S=n(f),T=n(S,!0);a(S);var j=s(S,2),q=n(j,!0);a(j);var O=s(j,2),J=n(O,!0);a(O),a(f),a(c),g(()=>{h(T,e(i).name),h(q,e(i).description),h(J,e(i).type_service)}),k("click",c,()=>ft(e(i))),l(o,c)}),a(r),l(t,r)},Et=t=>{var r=$t(),o=ct(r);{var i=c=>{var p=Ht();l(c,p)};I(o,c=>{e(P)||c(i)},!0)}l(t,r)};I(jt,t=>{e(B).length>0?t(Ct):t(Et,!1)})}a(nt),a(W);var It=s(W,2);{var Lt=t=>{var r=Wt(),o=n(r),i=n(o),c=n(i,!0);a(i);var p=s(i,2),z=n(p,!0);a(p);var b=s(p,2),y=s(n(b),2);g(()=>{e(L),tt(()=>{e(u)})});var f=n(y);f.value=f.__value="";var S=s(f);U(S,1,()=>e(u).variations,Y,(E,w)=>{var m=Kt(),V=n(m,!0);a(m);var A={};g(()=>{h(V,e(w).description),A!==(A=e(w).description)&&(m.value=(m.__value=e(w).description)??"")}),l(E,m)}),a(y),a(b);var T=s(b,2),j=s(n(T),2);g(()=>{e(N),tt(()=>{e(u)})});var q=n(j);q.value=q.__value="";var O=s(q);U(O,1,()=>e(u).availableDates,Y,(E,w)=>{var m=Qt(),V=n(m,!0);a(m);var A={};g((Nt,st)=>{h(V,Nt),A!==(A=st)&&(m.value=(m.__value=st)??"")},[()=>xt(e(w).date,e(w).time),()=>bt(e(w).date,e(w).time)]),l(E,m)}),a(j),a(T);var J=s(T,2),_=n(J),C=s(_,2);a(J),a(o),a(r),g(()=>{h(c,e(u).name),h(z,e(u).description)}),et(y,()=>e(L),E=>d(L,E)),et(j,()=>e(N),E=>d(N,E)),k("click",_,rt),k("click",C,ht),l(t,r)};I(It,t=>{e(u)&&t(Lt)})}At(M,()=>e(F),t=>d(F,t)),k("input",M,Q),et($,()=>e(D),t=>d(D,t)),k("change",$,Q),l(vt,ot),Rt()}export{se as component};
