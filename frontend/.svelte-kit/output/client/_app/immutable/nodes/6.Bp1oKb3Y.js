import"../chunks/DsnmJJEf.js";import{i as Qe}from"../chunks/D-A7yCOM.js";import{o as Ue,a as Ge,e as g,s as b}from"../chunks/BDJC6Cp_.js";import{p as Ke,f as p,t as w,c as i,g as t,b as v,d as Xe,s as o,e as l,m as x,r as s,i as Ye,Q as Ze,n as et,h as tt,a as at,R as ce}from"../chunks/BDVzeZar.js";import{i as B}from"../chunks/DE00MdZp.js";import{e as T,b as rt,i as N}from"../chunks/YH6WcyyF.js";import{r as M,s as ge}from"../chunks/Cs6Urel8.js";import{b as I}from"../chunks/CTeKP5p8.js";import{g as he}from"../chunks/ccQLpX6y.js";function ot(R){return function(...O){var A=O[0];return A.preventDefault(),R?.apply(this,O)}}var st=p('<p class="text-gray-500 text-sm">Nenhuma notificação ainda.</p>'),it=p('<p class="text-sm text-gray-700"> </p>'),nt=p("<option> </option>"),lt=p('<div class="flex gap-2 items-center"><input type="text" class="border-gray-300 rounded-md p-2 w-auto focus:ring-2 focus:ring-blue-500" placeholder="ex: R$20, 2 vezes por semana" required/> <button type="button" class="bg-red-500 text-white px-2 py-1 rounded">✕</button></div>'),ct=p('<div class="flex gap-2 items-center"><input type="date" class="border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" required/> <input type="time" class="border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" required/> <button type="button" class="bg-red-500 text-white px-2 py-1 rounded">✕</button></div>'),dt=p('<p class="text-sm mt-2 text-blue-600 font-medium text-center"> </p>'),vt=p('<p class="text-gray-500 italic">Você ainda não criou nenhum serviço.</p>'),ut=p('<img class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"/>'),pt=p('<div class="w-full h-full bg-gray-100 flex items-center justify-center text-gray-400 text-xs">Sem imagem</div>'),mt=p('<div class="flex flex-col items-center text-center bg-white rounded-lg shadow-sm hover:shadow-md transition duration-200 p-1"><div class="relative w-full aspect-square max-w-[120px] rounded-md overflow-hidden"><!></div> <div class="mt-1 space-y-0.5 max-w-[120px] leading-tight text-xs"><p><span class="font-medium">Nome:</span> </p> <p><span class="font-medium">Descrição:</span> </p> <p><span class="font-medium">Tipo:</span> </p></div> <button class="mt-1 bg-red-500 hover:bg-red-600 text-white px-2 py-0.5 rounded text-xs transition">Deletar</button></div>'),ft=p('<div class="grid justify-center gap-x-2 gap-y-5" style="grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); max-width: 900px; margin: 0 auto;"></div>'),bt=p('<p class="text-gray-500 italic">Nenhum contrato ainda.</p>'),xt=p('<div class="flex justify-between items-start bg-white border rounded p-3"><div class="text-sm text-gray-800 space-y-1"><p><span class="font-medium">Serviço:</span> </p> <p><span class="font-medium">Cliente:</span> </p> <p><span class="font-medium">Variação:</span> </p> <p><span class="font-medium">Data:</span> </p></div> <button class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-xs">Cancelar</button></div>'),gt=p('<div class="space-y-2 max-w-2xl mx-auto"></div>'),ht=p('<div class="p-6 max-w-5xl mx-auto space-y-8"><div class="mb-6 p-4 border rounded bg-gray-50"><h2 class="font-semibold text-lg mb-2">Notificações</h2> <!></div> <header class="flex items-center justify-between"><h1 class="text-3xl font-bold text-gray-800">Painel do Administrador</h1> <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-md text-sm font-medium transition">Ir para Perfil</button></header> <section class="bg-white rounded-xl shadow p-6 space-y-6 border border-gray-100 max-w-2xl mx-auto"><h2 class="text-xl font-semibold text-gray-800 border-b pb-2 text-center">Criar Novo Serviço</h2> <form class="space-y-4"><div class="mx-auto max-w-xs"><label class="block text-sm font-medium mb-1 text-gray-700">Tipo de Serviço</label> <select class="border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 w-auto" required><option>-- Selecione o tipo --</option><!></select></div> <div class="mx-auto max-w-xs"><label class="block text-sm font-medium mb-1 text-gray-700">Nome do Serviço</label> <input type="text" class="border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 w-auto" required/></div> <div class="mx-auto max-w-md"><label class="block text-sm font-medium mb-1 text-gray-700">Descrição</label> <textarea rows="3" class="border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 w-auto"></textarea></div> <div class="mx-auto max-w-xs"><label class="block text-sm font-medium mb-1 text-gray-700">Imagem</label> <input type="file" accept="image/*" class="block text-sm text-gray-600 file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/></div> <div class="mx-auto space-y-2"><label class="block text-sm font-medium mb-1 text-gray-700">Variações</label> <!> <button type="button" class="bg-green-500 text-white px-3 py-1 rounded mt-1">+ Adicionar Variação</button></div> <div class="mx-auto space-y-2"><label class="block text-sm font-medium mb-1 text-gray-700">Disponibilidade</label> <!> <button type="button" class="bg-green-500 text-white px-3 py-1 rounded mt-1">+ Adicionar Data/Horário</button></div> <div class="flex justify-center"><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">Criar Serviço</button></div></form> <!></section> <section class="mt-6"><h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Seus Serviços</h2> <!></section> <section class="mt-8"><h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Contratos</h2> <!></section></div>');function Nt(R,O){Ke(O,!1);let A=x([]),$=x([]),C=x([]),k=x(""),q=x(""),P=x(""),W=null,S=x(""),m=x([""]),u=x([{date:"",start:""}]),h=null,de,H=x([]),E;Ue(async()=>{if(h=localStorage.getItem("token"),de=localStorage.getItem("role")||"guest",!h||de!=="adm"){he("/");return}E=new WebSocket(`ws://localhost:3000?token=${h}`),E.onopen=()=>console.log("Conectado ao WebSocket de notificações"),E.onmessage=e=>{try{const a=JSON.parse(e.data);l(H,[{message:`O serviço "${a.serviceName}" foi contratado pelo cliente ${a.clientName}`}]),Q()}catch(a){console.error("Mensagem WebSocket inválida:",a)}},E.onerror=e=>console.error("Erro no WebSocket:",e),await _e(),await ve(),await Q()}),Ge(()=>{E&&E.close()});async function _e(){try{const e=await fetch("http://localhost:3000/api/service-types");l(A,await e.json())}catch(e){console.error("Erro ao buscar tipos de serviço:",e)}}async function ve(){try{const e=await fetch("http://localhost:3000/api/user-services",{headers:{Authorization:`Bearer ${h}`}});if(!e.ok)return console.error("Erro ao buscar serviços do usuário",await e.text());l($,await e.json())}catch(e){console.error("Erro ao buscar serviços do usuário:",e)}}async function Q(){try{const e=await fetch("http://localhost:3000/api/contracts",{headers:{Authorization:`Bearer ${h}`}});if(!e.ok)return console.error("Erro ao buscar contratos",await e.text());l(C,await e.json())}catch(e){console.error("Erro ao buscar contratos:",e)}}function ye(e){W=e.target.files[0]}function we(){l(m,[...t(m),""])}function ke(e){t(m).length>1&&l(m,t(m).filter((a,r)=>r!==e))}function Se(){l(u,[...t(u),{date:"",start:""}])}function Ee(e){t(u).length>1&&l(u,t(u).filter((a,r)=>r!==e))}async function De(e){if(e.preventDefault(),!t(k)||!t(q)||!t(m).some(r=>r.trim()!=="")||t(u).some(r=>!r.date||!r.start)){l(S,"Todos os campos (tipo, nome, variações, disponibilidade) são obrigatórios.");return}const a=new FormData;a.append("typeId",t(k)),a.append("name",t(q)),a.append("description",t(P)),W&&a.append("picture",W),a.append("variations",JSON.stringify(t(m).filter(r=>r.trim()!==""))),a.append("availability",JSON.stringify(t(u)));try{const r=await fetch("http://localhost:3000/api/user-services",{method:"POST",headers:{Authorization:`Bearer ${h}`},body:a}),n=await r.json();r.ok?(l(S,"✅ Serviço criado com sucesso!"),l(q,l(P,l(k,""))),W=null,l(m,[""]),l(u,[{date:"",start:""}]),await ve()):l(S,n.error||"Erro ao criar serviço")}catch(r){console.error("Erro ao criar serviço:",r),l(S,"Erro de rede")}}function je(){he("/profile")}async function Te(e){if(confirm("Tem certeza que deseja deletar este serviço?"))try{if(!(await fetch(`http://localhost:3000/api/services/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`}})).ok)throw new Error("Falha ao deletar serviço");l($,t($).filter(r=>r.id!==e)),await Q()}catch(a){console.error("Erro ao deletar serviço:",a),alert("Falha ao deletar serviço")}}async function Ne(e){if(confirm("Tem certeza que deseja cancelar este contrato?"))try{if(!(await fetch(`http://localhost:3000/api/contracts/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`}})).ok)throw new Error("Falha ao cancelar contrato");l(C,t(C).filter(r=>r.contract_id!==e))}catch(a){console.error("Erro ao cancelar contrato:",a),alert("Falha ao cancelar contrato")}}Qe();var U=ht(),G=i(U),Ae=o(i(G),2);{var $e=e=>{var a=st();v(e,a)},Ce=e=>{var a=tt(),r=at(a);T(r,1,()=>t(H),N,(n,c)=>{var d=it(),f=i(d,!0);s(d),w(()=>b(f,t(c).message)),v(n,d)}),v(e,a)};B(Ae,e=>{t(H).length===0?e($e):e(Ce,!1)})}s(G);var K=o(G,2),qe=o(i(K),2);s(K);var X=o(K,2),J=o(i(X),2),Y=i(J),Z=o(i(Y),2);w(()=>{t(k),Ye(()=>{t(A)})});var ee=i(Z);ee.value=ee.__value="";var ze=o(ee);T(ze,1,()=>t(A),N,(e,a)=>{var r=nt(),n=i(r,!0);s(r);var c={};w(()=>{b(n,t(a).type),c!==(c=t(a).id)&&(r.value=(r.__value=t(a).id)??"")}),v(e,r)}),s(Z),s(Y);var te=o(Y,2),ue=o(i(te),2);M(ue),s(te);var ae=o(te,2),pe=o(i(ae),2);Ze(pe),s(ae);var re=o(ae,2),Fe=o(i(re),2);s(re);var oe=o(re,2),me=o(i(oe),2);T(me,1,()=>t(m),N,(e,a,r)=>{var n=lt(),c=i(n);M(c);var d=o(c,2);s(n),I(c,()=>t(m)[r],f=>ce(m,t(m)[r]=f)),g("click",d,()=>ke(r)),v(e,n)});var Ve=o(me,2);s(oe);var fe=o(oe,2),be=o(i(fe),2);T(be,1,()=>t(u),N,(e,a,r)=>{var n=ct(),c=i(n);M(c);var d=o(c,2);M(d);var f=o(d,2);s(n),I(c,()=>t(u)[r].date,_=>ce(u,t(u)[r].date=_)),I(d,()=>t(u)[r].start,_=>ce(u,t(u)[r].start=_)),g("click",f,()=>Ee(r)),v(e,n)});var Be=o(be,2);s(fe),et(2),s(J);var Ie=o(J,2);{var Oe=e=>{var a=dt(),r=i(a,!0);s(a),w(()=>b(r,t(S))),v(e,a)};B(Ie,e=>{t(S)&&e(Oe)})}s(X);var se=o(X,2),Pe=o(i(se),2);{var We=e=>{var a=vt();v(e,a)},Je=e=>{var a=ft();T(a,5,()=>t($),N,(r,n)=>{var c=mt(),d=i(c),f=i(d);{var _=j=>{var V=ut();w(()=>{ge(V,"src",t(n).picture),ge(V,"alt",t(n).name)}),v(j,V)},z=j=>{var V=pt();v(j,V)};B(f,j=>{t(n).picture?j(_):j(z,!1)})}s(d);var F=o(d,2),y=i(F),ie=o(i(y));s(y);var D=o(y,2),ne=o(i(D));s(D);var L=o(D,2),le=o(i(L));s(L),s(F);var He=o(F,2);s(c),w(()=>{b(ie,` ${t(n).name??""}`),b(ne,` ${t(n).description??""}`),b(le,` ${t(n).type??""}`)}),g("click",He,()=>Te(t(n).id)),v(r,c)}),s(a),v(e,a)};B(Pe,e=>{t($).length===0?e(We):e(Je,!1)})}s(se);var xe=o(se,2),Le=o(i(xe),2);{var Me=e=>{var a=bt();v(e,a)},Re=e=>{var a=gt();T(a,5,()=>t(C),N,(r,n)=>{var c=xt(),d=i(c),f=i(d),_=o(i(f));s(f);var z=o(f,2),F=o(i(z));s(z);var y=o(z,2),ie=o(i(y));s(y);var D=o(y,2),ne=o(i(D));s(D),s(d);var L=o(d,2);s(c),w(le=>{b(_,` ${t(n).service_name??""}`),b(F,` ${t(n).client_name??""}`),b(ie,` ${t(n).variation??""}`),b(ne,` ${le??""}`)},[()=>new Date(t(n).datetime).toLocaleString()]),g("click",L,()=>Ne(t(n).contract_id)),v(r,c)}),s(a),v(e,a)};B(Le,e=>{t(C).length===0?e(Me):e(Re,!1)})}s(xe),s(U),g("click",qe,je),rt(Z,()=>t(k),e=>l(k,e)),I(ue,()=>t(q),e=>l(q,e)),I(pe,()=>t(P),e=>l(P,e)),g("change",Fe,ye),g("click",Ve,we),g("click",Be,Se),g("submit",J,ot(De)),v(R,U),Xe()}export{Nt as component};
